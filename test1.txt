Convert your JKS certificate to PEM format: OpenShift Routes with Edge TLS termination require the certificate and private key to be in PEM format. You'll need to use the keytool and openssl commands to perform this conversion.

Step 1: Export from JKS to PKCS12 (.p12 or .pfx):

Open a command prompt or PowerShell on your Windows machine (where you likely have the JKS file).

Bash

"C:\Program Files\Java\jdk-XX\bin\keytool" -importkeystore -srckeystore yourkeystore.jks -destkeystore output.p12 -deststoretype PKCS12
Replace "C:\Program Files\Java\jdk-XX\bin\keytool" with the actual path to your keytool.exe.
Replace yourkeystore.jks with the name of your JKS file.
You will be prompted for the JKS keystore password.
You will then be asked to create a password for the output.p12 file.
Step 2: Convert PKCS12 to PEM:

Ensure you have OpenSSL installed on your Windows machine.

Extract Certificate (certificate.pem):

Bash

openssl pkcs12 -in output.p12 -clcerts -nokeys -out certificate.pem
You will be prompted for the password of the output.p12 file.

Extract Private Key (private.key):

Bash

openssl pkcs12 -in output.p12 -nocerts -out private.key
You will be prompted for the password of the output.p12 file. You might also be asked to set a passphrase for the private key (you can leave it blank if you prefer no passphrase).

Create an OpenShift Secret containing the PEM certificate and key: This is the recommended way to securely manage your TLS credentials in OpenShift.

Open your OpenShift CLI and navigate to your Sourcegraph project:

Bash

oc project <your-sourcegraph-project-name>
Then, create the secret:

Bash

oc create secret tls sourcegraph-tls-cert --cert=certificate.pem --key=private.key
Replace <your-sourcegraph-project-name> with the actual name of your Sourcegraph project.
Ensure that certificate.pem and private.key are in the directory where you run this command.
Configure the OpenShift Route for Sourcegraph to use the TLS Secret:

You'll need to edit the OpenShift Route that exposes your Sourcegraph instance.

Using the OpenShift Web Console (UI):

Navigate to your Sourcegraph project.
Go to Networking -> Routes.
Find the Route for your Sourcegraph instance and click Edit Route.
Under TLS Settings:
Choose "Secure route".
For Termination, select "Edge".
Under "TLS Certificate Source", select "Secret".
From the "Secret name" dropdown, choose the secret you created in the previous step (sourcegraph-tls-cert).
(Optional) Configure "Insecure Traffic" as needed (e.g., "Redirect" to HTTPS).
Click Save.
Using the oc Command-Line Interface (CLI):

Edit your Sourcegraph Route:

Bash

oc edit route <your-sourcegraph-route-name> -n <your-sourcegraph-project-name>
Modify the spec.tls section of the Route definition to look like this:

YAML

spec:
  # ... other route configuration ...
  tls:
    termination: edge
    secretName: sourcegraph-tls-cert
  # ... other route configuration ...
Replace <your-sourcegraph-route-name> with the actual name of your Sourcegraph Route.

Save the changes to the YAML file.

Verify the Configuration:

Open your Sourcegraph URL in a web browser (using https://).
Your browser should now recognize the certificate you provided. Check the certificate details in your browser to confirm it's the correct one.
If you configured "Redirect" for insecure traffic, accessing the HTTP version of your Sourcegraph URL should automatically redirect to HTTPS.
Important Considerations:

Certificate Validity: Ensure your certificate is valid and not expired.
Hostname Matching: The "Common Name" (CN) or Subject Alternative Names (SANs) in your certificate must match the hostname you've configured for your OpenShift Route.
Intermediate Certificates: If your certificate was issued by an intermediate Certificate Authority (CA), you might need to include the CA certificate chain in the certificate.pem file (usually by concatenating the server certificate and the intermediate CA certificates in the correct order).
Private Key Security: Store your private key securely and ensure that only the OpenShift Router has access to it through the Secret.
Route Hostname: Make sure the host field in your OpenShift Route is set to the external hostname you want to use for Sourcegraph (the one that matches your certificate).
By following these steps, you should be able to successfully install your JKS certificate for your Sourcegraph deployment on OpenShift using Edge TLS termination. The OpenShift Router will handle the HTTPS connections using your certificate.
